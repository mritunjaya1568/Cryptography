

# This file was *autogenerated* from the file solve2.sage
from sage.all_cmdline import *   # import sage library

_sage_const_2 = Integer(2); _sage_const_414 = Integer(414); _sage_const_17 = Integer(17); _sage_const_3617 = Integer(3617); _sage_const_1 = Integer(1); _sage_const_0 = Integer(0); _sage_const_17319886477121189177719202498822615443556957307604340815256226171904769976866975908866528699294134494857887698432266169206165 = Integer(17319886477121189177719202498822615443556957307604340815256226171904769976866975908866528699294134494857887698432266169206165); _sage_const_34 = Integer(34); _sage_const_411 = Integer(411); _sage_const_33364140863755142520810177694098385178984727200411208589594759 = Integer(33364140863755142520810177694098385178984727200411208589594759); _sage_const_412 = Integer(412); _sage_const_22 = Integer(22); _sage_const_313 = Integer(313); _sage_const_13 = Integer(13); _sage_const_196 = Integer(196); _sage_const_29389900956614406804195679733048238721927197300216785144586024378999988819550861039522005309555174206184334563744077143526515 = Integer(29389900956614406804195679733048238721927197300216785144586024378999988819550861039522005309555174206184334563744077143526515); _sage_const_35393890305755889860162885313105764163711685229222879079392595581125504924571957049674311023316022028491019878405896203357959 = Integer(35393890305755889860162885313105764163711685229222879079392595581125504924571957049674311023316022028491019878405896203357959); _sage_const_323811241263249292936728039512527915123919581362694022248295847200852329370976362254362732891461683020125008591836401372097 = Integer(323811241263249292936728039512527915123919581362694022248295847200852329370976362254362732891461683020125008591836401372097); _sage_const_21 = Integer(21)# from secret import FLAG
 
# Implementation of Edwards Curve41417
# x ** 2 + y ** 2 = 1 + 3617 * x ** 2 * y ** 2
# Formulas from http://hyperelliptic.org/EFD/g1p/auto-edwards.html
 
P = _sage_const_2  ** _sage_const_414  - _sage_const_17 
d = _sage_const_3617  
 
def on_curve(p):
    x, y = p
    return (x * x + y * y) % P == (_sage_const_1  + d * x * x * y * y) % P
 

from Crypto.Util.number import *

def inv(x):
    return inverse(x,P)
 
def add(p1, p2):
    x1, y1 = p1
    x2, y2 = p2
    x = ( (x1 * y2 + y1 * x2) % P * inv((_sage_const_1  + d * x1 * x2 * y1 * y2)%P) )% P
    y = ( (y1 * y2 - x1 * x2)%P * inv((_sage_const_1  - d * x1 * x2 * y1 * y2)%P) ) % P
    return (x, y)
 
def sub(p1, p2):
    x1, y1 = p1
    x2, y2 = p2
    x2 = -_sage_const_1  * x2
    x = ( (x1 * y2 + y1 * x2) % P * inv((_sage_const_1  + d * x1 * x2 * y1 * y2)%P) )% P
    y = ( (y1 * y2 - x1 * x2)%P * inv((_sage_const_1  - d * x1 * x2 * y1 * y2)%P) ) % P
    return (x, y)

 
def mul(x: int, base):
    ans = (_sage_const_0 ,_sage_const_1 )
    cur = base
    while x > _sage_const_0 :
        if x & _sage_const_1 :
            ans = add(cur, ans)
        x >>= _sage_const_1 
        cur = add(cur, cur)
    return ans
 
base = (_sage_const_17319886477121189177719202498822615443556957307604340815256226171904769976866975908866528699294134494857887698432266169206165 , _sage_const_34 )
assert(on_curve(base))
 
order = _sage_const_2  ** _sage_const_411  - _sage_const_33364140863755142520810177694098385178984727200411208589594759 
 
# msg = int.from_bytes(FLAG, 'big')
# assert(msg < 2 ** 410)
 
# enc = mul(pow(msg, -1, order), base)
 
# print(f"{enc = }")
 
# Have a hint!
bm = (_sage_const_1  << _sage_const_412 ) - _sage_const_1 
bm = bm ^ ((_sage_const_1  << _sage_const_22 ) -_sage_const_1 ) << _sage_const_313 
bm = bm ^ ((_sage_const_1  << _sage_const_22 ) -_sage_const_1 ) << _sage_const_13 
bm = bm ^ _sage_const_1  << _sage_const_196 
 
# hint = bm & pow(msg, -1, order)
# print(f"{hint = }")
 
 
enc = (_sage_const_29389900956614406804195679733048238721927197300216785144586024378999988819550861039522005309555174206184334563744077143526515 , _sage_const_35393890305755889860162885313105764163711685229222879079392595581125504924571957049674311023316022028491019878405896203357959 )
hint = _sage_const_323811241263249292936728039512527915123919581362694022248295847200852329370976362254362732891461683020125008591836401372097 
 
 
# string1 = bm
string1 = '1111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000001111111111111'
string2 = string1[::-_sage_const_1 ]
lest = []
for i in range(len(string2)):
    if string2[i] == '0':
        lest.append(i)
print(lest)
 
 
# bin(bm & hint)[2:].zfill(412)
 
# bin(bm)[2:]
 
# bin(hint)[2:].zfill(412)
 
arr = [_sage_const_0 ,_sage_const_1 ]
from itertools import product
var = list(product(arr,repeat = _sage_const_22 ))
print(var)
 
lest1 = []
val1 = mul(_sage_const_2  ** _sage_const_13 ,base)  
lest1.append(val1)
 
for i in range(_sage_const_21 ):
    val1 = mul(_sage_const_2 ,val1)
    lest1.append(val1)
 
lest2 = []
val2 = mul(_sage_const_2  ** _sage_const_313 ,base)
lest2.append(val2)
 
for i in range(_sage_const_21 ):
    val2 = mul(_sage_const_2 ,val2)
    lest2.append(val2)
 
 
 
l1 = set()
r1 = set()
 
print("Process started")
 
from tqdm import tqdm
 
for i in tqdm(range(len(var))):
 
    s1 = (_sage_const_0 ,_sage_const_1 )
    s2 = (_sage_const_0 ,_sage_const_1 )
 
    for j in range(len(var[i])):
        if var[i][j] == _sage_const_1 :
            s1 = add(s1, lest1[j])
            s2 = add(s2, lest2[j])
 
    l1.add(s1)
    r1.add(s2)
    print(i)

print("Set Made and starting the search for 1st case")
 
ct = sub(enc,mul(bm & hint,base))
 
# 1st case
 
# a23 = 0
 
for x in l1:
    if sub(ct,x) in r1:
        print("Got the pair in 1st case with a23 = 0")
        print(x,sub(ct,x))
 
 
print("1st search done")
 
 
 
# 2nd case
 
# a23 = 1 
 
ct2 = sub( ct, mul(_sage_const_2  ** _sage_const_196 , base) )
 
for x in l1:
    if sub(ct2,x) in r1:
        print("Got the pair in 2nd case with a23 = 1")
        print(x,sub(ct2,x))
 
print("2nd search done")


